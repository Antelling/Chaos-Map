# 2026-02-12

## Chaos Map - CPU High Precision Rendering Mode

Added a new pure CPU rendering option for the chaos map visualization. This provides higher precision computation without GPU float32 quantization.

### Changes Made:

1. **New Render Mode Dropdown** (`chaos-map.html`)
   - GPU (WebGL - Fast) - default
   - CPU (High Precision) - pure CPU double precision

2. **New CPU Renderer** (`js/chaos-renderer-cpu.js`)
   - `CPUChaosMapRenderer` class with full double precision
   - RK4 integrator matching the WebGL shader exactly
   - Supports all color mappings (Rainbow, Heatmap, Viridis, etc.)
   - Supports both integrators (RK4 and Verlet)
   - Supports all perturbation modes (Fixed and Random Gaussian)
   - Deterministic randomness using hash-based RNG (matches GPU)

3. **Updated Main Renderer** (`js/chaos-renderer.js`)
   - Added `cpuChaosRenderer` instance
   - Added `renderMode` property

4. **Updated UI** (`js/chaos-renderer-ui.js`)
   - Event listener for render mode dropdown

5. **Updated Render Pipeline** (`js/chaos-renderer-render.js`)
   - Split `generateMap` into GPU and CPU paths
   - GPU mode: existing WebGL tile rendering
   - CPU mode: high-precision pixel-by-pixel computation

6. **Removed Float32 Rounding** (`js/pendulum-sim-cpu.js`)
   - Removed all `Math.fround()` calls
   - Full JavaScript double precision for pendulum simulations

### Key Technical Details:
- Uses `ImageData` for direct pixel manipulation
- Tile-based rendering to maintain UI responsiveness
- Same physics calculations as GPU shader but with 64-bit precision
- No quantization artifacts in divergence measurements

---

## Git Repository Restructure

Reorganized the Chaos-Map repository branches:
- Consolidated all work to `main` as the primary branch
- Deleted `master` branch (both local and remote)
- Created `cpu-sim-backend` branch for initial integration
- Created `optimized` branch for performance work

---

## GPU Streaming Display

Both renderers now stream tiles as they complete:

| Renderer | Method | Display |
|----------|--------|---------|
| **GPU (WebGL)** | `gl.readPixels()` per tile | Live tile-by-tile |
| **CPU (WebWorkers)** | Worker message per tile | Live tile-by-tile |

### Implementation:
- `renderTileToImageData()` - renders tile, reads pixels back, returns ImageData
- `generateMapGPU()` - draws each tile immediately as it completes
- Y-flip handled (WebGL bottom-left vs Canvas top-left origin)

### Trade-off:
`gl.readPixels()` is slower than offscreen compositing, but you see progress happening in real-time instead of waiting for the full image.
