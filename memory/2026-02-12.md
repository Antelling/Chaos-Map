# 2026-02-12

## Chaos Map - CPU High Precision Rendering Mode

Added a new pure CPU rendering option for the chaos map visualization. This provides higher precision computation without GPU float32 quantization.

### Changes Made:

1. **New Render Mode Dropdown** (`chaos-map.html`)
   - GPU (WebGL - Fast) - default
   - CPU (High Precision) - pure CPU double precision

2. **New CPU Renderer** (`js/chaos-renderer-cpu.js`)
   - `CPUChaosMapRenderer` class with full double precision
   - RK4 integrator matching the WebGL shader exactly
   - Supports all color mappings (Rainbow, Heatmap, Viridis, etc.)
   - Supports both integrators (RK4 and Verlet)
   - Supports all perturbation modes (Fixed and Random Gaussian)
   - Deterministic randomness using hash-based RNG (matches GPU)

3. **Updated Main Renderer** (`js/chaos-renderer.js`)
   - Added `cpuChaosRenderer` instance
   - Added `renderMode` property

4. **Updated UI** (`js/chaos-renderer-ui.js`)
   - Event listener for render mode dropdown

5. **Updated Render Pipeline** (`js/chaos-renderer-render.js`)
   - Split `generateMap` into GPU and CPU paths
   - GPU mode: existing WebGL tile rendering
   - CPU mode: high-precision pixel-by-pixel computation

6. **Removed Float32 Rounding** (`js/pendulum-sim-cpu.js`)
   - Removed all `Math.fround()` calls
   - Full JavaScript double precision for pendulum simulations

### Key Technical Details:
- Uses `ImageData` for direct pixel manipulation
- Tile-based rendering to maintain UI responsiveness
- Same physics calculations as GPU shader but with 64-bit precision
- No quantization artifacts in divergence measurements

---

## Git Repository Restructure

Reorganized the Chaos-Map repository branches:
- Consolidated all work to `main` as the primary branch
- Deleted `master` branch (both local and remote)
- Created `cpu-sim-backend` branch for initial integration
- Created `optimized` branch for performance work

---

## CPU Pendulum Simulation Optimization

Optimized `js/pendulum-sim-cpu.js` for significantly better performance without sacrificing accuracy.

### Optimizations Applied:
- **Float32Array for state** - Replaces objects + Math.fround() with typed arrays
- **Removed redundant alpha loops** - Was O(n) every frame setting constant values
- **Batched trail rendering** - Single canvas path instead of individual stroke() calls
- **Sampled energy calculation** - Every 5 frames instead of every frame
- **Pre-computed M (m1+m2)** - Eliminates redundant additions in acceleration calc
- **Pre-allocated temp arrays** - Avoids GC pressure during hot loops
- **Flat trail arrays** - [x1,y1,x2,y2,...] instead of object array for cache locality
- **Bounded history sizes** - Prevents unbounded memory growth over time
- **Inlined coordinate transforms** - Fewer function calls in render hot path

### Accuracy Preserved:
- Same Velocity Verlet symplectic integrator
- Same 32-bit float precision (via Float32Array)
- Identical physics calculations, just faster implementation
