# 2026-02-12

## Chaos Map - CPU High Precision Rendering Mode

Added a new pure CPU rendering option for the chaos map visualization. This provides higher precision computation without GPU float32 quantization.

### Changes Made:

1. **New Render Mode Dropdown** (`chaos-map.html`)
   - GPU (WebGL - Fast) - default
   - CPU (High Precision) - pure CPU double precision

2. **New CPU Renderer** (`js/chaos-renderer-cpu.js`)
   - `CPUChaosMapRenderer` class with full double precision
   - RK4 integrator matching the WebGL shader exactly
   - Supports all color mappings (Rainbow, Heatmap, Viridis, etc.)
   - Supports both integrators (RK4 and Verlet)
   - Supports all perturbation modes (Fixed and Random Gaussian)
   - Deterministic randomness using hash-based RNG (matches GPU)

3. **Updated Main Renderer** (`js/chaos-renderer.js`)
   - Added `cpuChaosRenderer` instance
   - Added `renderMode` property

4. **Updated UI** (`js/chaos-renderer-ui.js`)
   - Event listener for render mode dropdown

5. **Updated Render Pipeline** (`js/chaos-renderer-render.js`)
   - Split `generateMap` into GPU and CPU paths
   - GPU mode: existing WebGL tile rendering
   - CPU mode: high-precision pixel-by-pixel computation

6. **Removed Float32 Rounding** (`js/pendulum-sim-cpu.js`)
   - Removed all `Math.fround()` calls
   - Full JavaScript double precision for pendulum simulations

### Key Technical Details:
- Uses `ImageData` for direct pixel manipulation
- Tile-based rendering to maintain UI responsiveness
- Same physics calculations as GPU shader but with 64-bit precision
- No quantization artifacts in divergence measurements

---

## Git Repository Restructure

Reorganized the Chaos-Map repository branches:
- Consolidated all work to `main` as the primary branch
- Deleted `master` branch (both local and remote)
- Created `cpu-sim-backend` branch for initial integration
- Created `optimized` branch for performance work

---

## Unified CPU Physics Engine

Created a single shared CPU physics engine used by both chaos map and pendulum simulation.

### New File: js/cpu-physics.js
The one true CPU physics engine:
```javascript
computeAccelerations(theta1, theta2, omega1, omega2, l1, l2, m1, m2, g)
computeDerivatives(...)  // For RK4
stepVerlet(state, l1, l2, m1, m2, dt, g)  // Symplectic
stepRK4(state, l1, l2, m1, m2, dt, g)     // 4th order
measureDivergence(s1, s2)
simulateToDivergence(s1, s2, maxIter, threshold, dt, g, integrator)
```

### Usage:
- **Chaos Map WebWorkers**: `importScripts('cpu-physics.js')` → use `self.CPUPhysics`
- **Pendulum Sim**: Load `cpu-physics.js` → use `window.CPUPhysics`

### Benefits:
- Single source of truth for 64-bit physics
- Both systems get identical results
- Easier maintenance
- No code duplication

### Architecture Summary:
```
┌─────────────────┐     ┌─────────────────┐
│  Chaos Map      │     │  Pendulum Sim   │
│  (WebWorkers)   │     │  (Main Thread)  │
└────────┬────────┘     └────────┬────────┘
         │                       │
         └───────────┬───────────┘
                     │
            ┌────────▼────────┐
            │  cpu-physics.js │
            │  (64-bit engine)│
            └─────────────────┘
```
